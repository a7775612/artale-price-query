<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <div style="border: 1px solid rgb(66, 170, 255); padding: 4px; margin-bottom: 6px;">
        <div>
            <div class="item"><a href="https://maplesaga.com/library/cn/permalink/equip/1002037" target="_blank"
                    style="color: inherit; text-decoration: none;"><img
                        src="image/%E9%BB%91%E8%89%B2%E8%A1%93%E5%A3%AB%E5%B8%BD.png" alt="黑色術士帽"
                        class="item-icon"><span>黑色術士帽</span></a></div>
            <div class="item"><a href="https://maplesaga.com/library/cn/permalink/equip/1002163" target="_blank"
                    style="color: inherit; text-decoration: none;"><img
                        src="image/%E7%B6%A0%E9%9B%99%E7%BF%BC%E4%B9%8B%E5%B8%BD.png" alt="綠雙翼之帽"
                        class="item-icon"><span>綠雙翼之帽</span></a></div>
            <div class="item"><a href="https://maplesaga.com/library/cn/permalink/equip/1002628" target="_blank"
                    style="color: inherit; text-decoration: none;"><img
                        src="image/%E7%B4%85%E8%89%B2%E7%9A%87%E5%AE%B6%E9%A0%AD%E5%B7%BE.png" alt="紅色皇家頭巾"
                        class="item-icon"><span>紅色皇家頭巾</span></a></div>
            <div class="item"><a href="https://maplesaga.com/library/cn/permalink/equip/1032011" target="_blank"
                    style="color: inherit; text-decoration: none;"><img
                        src="image/%E8%97%8D%E6%9C%88%E8%80%B3%E7%92%B0.png" alt="藍月耳環"
                        class="item-icon"><span>藍月耳環</span></a></div>
            <div class="item"><a href="https://maplesaga.com/library/cn/permalink/equip/1040028" target="_blank"
                    style="color: inherit; text-decoration: none;"><img src="image/%E8%92%BC%E5%A4%A9%E8%A1%A3.png"
                        alt="蒼天衣" class="item-icon"><span>蒼天衣</span></a></div>
            <div class="item"><a href="https://maplesaga.com/library/cn/permalink/equip/1040073" target="_blank"
                    style="color: inherit; text-decoration: none;"><img
                        src="image/%E8%97%8D%E5%AE%88%E8%AD%B7%E4%B9%8B%E6%9C%8D.png" alt="藍守護之服"
                        class="item-icon"><span>藍守護之服</span></a></div>
            <div class="item"><a href="https://maplesaga.com/library/cn/permalink/equip/1041053" target="_blank"
                    style="color: inherit; text-decoration: none;"><img
                        src="image/%E9%BB%91%E7%A5%9E%E8%81%96%E6%B3%95%E8%A1%A3.png" alt="黑神聖法衣"
                        class="item-icon"><span>黑神聖法衣</span></a></div>
            <div class="item"><a href="https://maplesaga.com/library/cn/permalink/equip/1060020" target="_blank"
                    style="color: inherit; text-decoration: none;"><img
                        src="image/%E5%8D%8A%E7%99%BD%E6%AD%A6%E8%A4%B2.png" alt="半白武褲"
                        class="item-icon"><span>半白武褲</span></a></div>
            <div class="item"><a href="https://maplesaga.com/library/cn/permalink/equip/1061049" target="_blank"
                    style="color: inherit; text-decoration: none;"><img
                        src="image/%E9%BB%91%E7%A5%9E%E8%81%96%E8%A3%99.png" alt="黑神聖裙"
                        class="item-icon"><span>黑神聖裙</span></a></div>
            <div class="item"><a href="https://maplesaga.com/library/cn/permalink/equip/1061061" target="_blank"
                    style="color: inherit; text-decoration: none;"><img
                        src="image/%E8%97%8D%E5%AE%88%E8%AD%B7%E8%A4%B2.png" alt="藍守護褲"
                        class="item-icon"><span>藍守護褲</span></a></div>
            <div class="item"><a href="https://maplesaga.com/library/cn/permalink/equip/1082045" target="_blank"
                    style="color: inherit; text-decoration: none;"><img
                        src="image/%E9%BB%83%E9%87%91%E8%BF%BD%E6%93%8A%E6%89%8B%E5%A5%97.png" alt="黃金追擊手套"
                        class="item-icon"><span>黃金追擊手套</span></a></div>
            <div class="item"><a href="https://maplesaga.com/library/cn/permalink/equip/1302017" target="_blank"
                    style="color: inherit; text-decoration: none;"><img
                        src="image/%E8%97%8D%E8%89%B2%E9%9B%A8%E5%82%98.png" alt="藍色雨傘"
                        class="item-icon"><span>藍色雨傘</span></a></div>
            <div class="item"><a href="https://maplesaga.com/library/cn/permalink/equip/1322001" target="_blank"
                    style="color: inherit; text-decoration: none;"><img src="image/%E9%8C%98%E5%AD%90.png" alt="錘子"
                        class="item-icon"><span>錘子</span></a></div>
            <div class="item"><a href="https://maplesaga.com/library/cn/permalink/equip/1332001" target="_blank"
                    style="color: inherit; text-decoration: none;"><img src="image/%E5%8D%8A%E6%9C%88%E5%88%83.png"
                        alt="半月刃" class="item-icon"><span>半月刃</span></a></div>
            <div class="item"><a href="https://maplesaga.com/library/cn/permalink/equip/1492004" target="_blank"
                    style="color: inherit; text-decoration: none;"><img
                        src="image/%E5%86%B7%E9%85%B7%E4%B9%8B%E5%BF%83.png" alt="冷酷之心"
                        class="item-icon"><span>冷酷之心</span></a></div>
            <div class="item"><a href="https://maplesaga.com/library/cn/permalink/equip/2070003" target="_blank"
                    style="color: inherit; text-decoration: none;"><img src="image/%E9%9B%AA%E8%8A%B1%E9%8F%A2.png"
                        alt="雪花鏢" class="item-icon"><span>雪花鏢</span></a></div>
        </div>
    </div>

    <script>
        const DEBOUNCE = 100;
        const apiUrl = "http://localhost:3000/query";
        const items = document.querySelectorAll('.item');

        let timer;
        let tooltip;

        function createTooltip() {
            tooltip = document.createElement("div");
            tooltip.className = "tooltip";

            // 動態設定樣式
            Object.assign(tooltip.style, {
                position: "absolute",
                backgroundColor: "#fff",
                border: "1px solid #ccc",
                padding: "6px 10px",
                fontSize: "14px",
                boxShadow: "0 0 5px rgba(0, 0, 0, 0.2)",
                borderRadius: "4px",
                pointerEvents: "none",
                zIndex: "999",
                whiteSpace: "nowrap",
                display: "none"
            });

            document.body.appendChild(tooltip);
        }

        function showTooltip(content, x, y) {
            if (!tooltip) createTooltip();
            tooltip.innerHTML = content;
            tooltip.style.left = `${x + 10}px`;
            tooltip.style.top = `${y + 10}px`;
            tooltip.style.display = "block";
        }

        function hideTooltip() {
            if (tooltip) {
                tooltip.style.display = "none";
            }
        }

        items.forEach(item => {
            item.addEventListener("mouseover", (e) => {
                e.stopPropagation();
                if (!["img", "span"].includes(e.target.tagName.toLowerCase())) {
                    return;
                }

                const icon = item.querySelector(".item-icon");
                const itemName = icon.alt;
                console.log(`Hovering over: ${itemName}`);
                const rect = icon.getBoundingClientRect();

                if (timer) clearTimeout(timer);

                timer = setTimeout(async () => {
                    console.log(`Fetching data for: ${itemName}`);
                    try {
                        const response = await fetch(`${apiUrl}?itemName=${encodeURIComponent(itemName)}`);
                        const data = await response.json();

                        if (Array.isArray(data) && data.length > 0) {
                            console.log("Showing tooltip with data:", data);
                            const tooltipText = data.map(entry =>
                                `${entry.currency} ${new Intl.NumberFormat().format(entry.amount)}（更新時間: ${entry.updateOn}）`
                            ).join("<br>");
                            showTooltip(`<strong>${itemName}</strong><br>${tooltipText}`, rect.right, rect.top);
                        } else {
                            showTooltip(`<strong>${itemName}</strong><br>無資料`, rect.right, rect.top);
                        }

                    } catch (err) {
                        showTooltip(`<strong>${itemName}</strong><br>資料取得失敗`, rect.right, rect.top);
                        console.error("Fetch failed:", err);
                    }
                }, DEBOUNCE);
            });

            item.addEventListener("mouseout", () => {
                if (timer) clearTimeout(timer);
                hideTooltip();
            });
        });
    </script>

</body>

</html>